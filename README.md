OpenEye CCTV
===
시설물 패턴 이상 징후 감지기
---
# 프로젝트 설명
아파트 시설물 관리 CCTV에 각 시설이 정해진 패턴에서 벗어났을 시 관제 시스템에 경고를 보내는 시스템 프로젝트.
아파트 시설물 관리를 위해 아파트 단지 내 cctv는 굉장히 많은 곳에 설치되어 있고 관리실의 중앙관제실에서 이를 관리한다. 하지만 cctv는 단순히 녹화 용으로 사용하기 때문에 아파트 단지 내에서 입주민이 시설물 관리 미흡으로 인해 사고를 당하게 되면 후에 확인 하는 용도로만 활용하게 되는 한계가 있고, 사고 후 보험 처리를 위해 녹화된 cctv로 서로의 입장을 입증해야 하는 갈등 상황이 발생되기도 한다.
opencv와 yolo를 사용하여 시설물의 패턴을 기억하고 패턴에서 벗어나게 될 때 중앙관제실 모니터에 경고 문구를 띄워 시설물 유지보수에 도움이 되고 고장난 시설물이 방치되지 않아 그로 인해 시설물 관리 비용 절감, 입주민의 안전을 확보한다.

## 기존 cctv 관제 시스템의 한계점
1. 단순 녹화.
2. 시설물에 이상이 생겼을 때 cctv로 발견하기 어렵기 때문에 경비원의 주기적인 순찰에 의지해야함. 순찰 시간 외에 고장이 나면 파악이 어려움.
3. 시설물 이상을 감지하지 못해 방치됐을 때 수리 골든타임을 놓쳐 비용이 더 드는 문제 발생. 장기간 입주민이 불편을 느낌.
4. 시설물의 고장을 파악하지 못해 장기간 방치 되었을 시 입주민의 안전 위협.
5. 사고 발생 시 사고 발생 후 원인 파악, 증거 입증 등으로만 활용이 가능함.



## 개선점
1. cctv 앵글에 들어와 있는 시설물의 패턴을 실시간 감지하여 패턴에서 일정 기준 이상 벗어난 경우 중앙관제시스템 모니터에  (*번 cctv의 위치) 경고 문구를 띄우는 실시간 감지 cctv
2. 실시간으로 시설물의 이상을 체크하므로 경비원의 순찰에만 의지하지 않고, 문제 발생 시점이 즉각 파악이 가능함.
3. 시설물 고장이 장기간 방치되는 것을 방지함. 적절한 수리 시기를 놓치지 않을 가능성이 높아지므로 유지보수 비용이 절감 되는 효과가 있음. 시설 고장으로 인해 입주민이 느끼는 불편한 기간을 줄일 수 있음.
4. 시설물 고장이 장기간 방치 되지 않음으로 입주민의 안전이 더 보장됨.
5. 사고 발생을 사전에 예방할 수 있고, 사고가 나더라도 정확한 원인을 데이터로 확실하게 파악 할 수 있음.


## 사용 하드웨어
- 개인 pc(맥북 프로(M1 pro), GPU 없음)
- 라즈베리파이 5 / piCam


# 진행상황
- [250814 피드백 진행](/feedback/250814.md)

- 홍찬호
    - 좋은 점: 일단 좋음. 원격으로 관리실에서 문제 상황 인식해서 유지보수팀에 연락을 해서 조취를 취할 수 있다. 해결하기까지 과정 자체가 단축될 것 같다. 이 것으로 인해 입주민의 안전을 확보할 수 있다.



    - 우려되는 점: 데이터셋이 많이 필요할 것 같다. 시행을 할 때 관리실에서 원할까? 굳이 수리를 하려고 하지 않은 시설도 계속 경고 문구를 받게 된다. 경고에 대해 라벨링을 해놓는 것은 어떨까? 입주민 안전과 직접 관련된 시설의 경우 하이레벨의 경고 및 라벨링을 한다. 각각의 상황에 대한 경고 표시를 다르게 하면 좋을 것 같다.


- 박영찬
    - 좋은 점: 
     기본적으로 단지 안에 cctv가 많이 있기 때문에 접근 성이 좋아 보인다. 추가 설치나 비용이 적다. 공공의 이익/편의를 위한 것이라 좋음. 경비원이나 관리인들이 연령대가 높기 때문에 전체를 관리하기가 어려움이 있다. 인건비, 노동 문제가 어느정도 해결되는 점이 좋다.



    - 우려되는 점: 이거에 대한 변수가 많다. 데이터셋을 만들어서 저장하는 것에 대한 어려움.


- 스스로 생각한 우려되는 점: 공동현관 자동문을 입주민이 임의로 껐을 경우에는 패턴 이상 징후로 인식함.
---
- [250814 피드백 진행](/feedback/250825.md)
### 발견한 핵심 문제
- 템플릿 매칭에 사용되는 초록색 네모 박스 영역에 사람이나 물건이 들어오면 의자가 움직이지 않아도 패턴 이탈 감지를 하는 문제가 있음.

[문제 상황 사진]

<img alt="image" src="https://github.com/guysaint/openeye_cctv/blob/main/src/tests/problem.png">

### 설정한 목표
- Before: 템플릿 매칭으로 의자의 위치와 모양(상태)를 인식해서 변경되는 부분을 패턴 이탈 상황으로 감지시킴. 
- After: 템플릿 매칭을 하기 전에 이미지 전처리를 통해 매칭률을 높이고 roi 영역을 타이트하게 잡아 문제 해결을 시도해보려고 함.

### 동료 피드백 요약
- 박영찬: 템플릿 매칭이 좋은 것 같다. yolo를 이용해서 사람이 인식되면 그 것을 제외 시키면 될 것 같다. 아니면 의자를 매칭하는 박스 크기를 의자에 딱 맞게 설정해보는 것도 좋을 것 같다.
- 홍찬호: 
---