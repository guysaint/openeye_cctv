# 250813 주제 선정

제목: OpenEye CCTV
===
부제목: 시설물 패턴 이상 징후 감지기
---
# 프로젝트 설명
아파트 시설물 관리 CCTV에 각 시설이 정해진 패턴에서 벗어났을 시 관제 시스템에 경고를 보내는 시스템 프로젝트.
아파트 시설물 관리를 위해 아파트 단지 내 cctv는 굉장히 많은 곳에 설치되어 있고 관리실의 중앙관제실에서 이를 관리한다. 하지만 cctv는 단순히 녹화 용으로 사용하기 때문에 아파트 단지 내에서 입주민이 시설물 관리 미흡으로 인해 사고를 당하게 되면 후에 확인 하는 용도로만 활용하게 되는 한계가 있고, 사고 후 보험 처리를 위해 녹화된 cctv로 서로의 입장을 입증해야 하는 갈등 상황이 발생되기도 한다.
opencv와 yolo를 사용하여 시설물의 패턴을 기억하고 패턴에서 벗어나게 될 때 중앙관제실 모니터에 경고 문구를 띄워 시설물 유지보수에 도움이 되고 고장난 시설물이 방치되지 않아 그로 인해 시설물 관리 비용 절감, 입주민의 안전을 확보한다.

## 기존 cctv 관제 시스템의 한계점
1. 단순 녹화.
2. 시설물에 이상이 생겼을 때 cctv로 발견하기 어렵기 때문에 경비원의 주기적인 순찰에 의지해야함. 순찰 시간 외에 고장이 나면 파악이 어려움.
3. 시설물 이상을 감지하지 못해 방치됐을 때 수리 골든타임을 놓쳐 비용이 더 드는 문제 발생. 장기간 입주민이 불편을 느낌.
4. 시설물의 고장을 파악하지 못해 장기간 방치 되었을 시 입주민의 안전 위협.
5. 사고 발생 시 사고 발생 후 원인 파악, 증거 입증 등으로만 활용이 가능함.



## 개선점
1. cctv 앵글에 들어와 있는 시설물의 패턴을 실시간 감지하여 패턴에서 일정 기준 이상 벗어난 경우 중앙관제시스템 모니터에  (*번 cctv의 위치) 경고 문구를 띄우는 실시간 감지 cctv
2. 실시간으로 시설물의 이상을 체크하므로 경비원의 순찰에만 의지하지 않고, 문제 발생 시점이 즉각 파악이 가능함.
3. 시설물 고장이 장기간 방치되는 것을 방지함. 적절한 수리 시기를 놓치지 않을 가능성이 높아지므로 유지보수 비용이 절감 되는 효과가 있음. 시설 고장으로 인해 입주민이 느끼는 불편한 기간을 줄일 수 있음.
4. 시설물 고장이 장기간 방치 되지 않음으로 입주민의 안전이 더 보장됨.
5. 사고 발생을 사전에 예방할 수 있고, 사고가 나더라도 정확한 원인을 데이터로 확실하게 파악 할 수 있음.


## 사용 하드웨어
- 개인 pc(맥북 프로(M1 pro), GPU 없음)
- 라즈베리파이 5 / piCam

---

# 250814 피드백을 통한 개선점 찾기
## 경고 우선 순위의 문제
- 문제점
    - 관리실에서 굳이 수리하지 않아도 되는 시설의 경고 문구도 계속 봐야되는 문제점.
    - 당장 고치지 않아도 되는 시설임에도 경고를 계속 준다면 문제가 됨.
    - 변수가 굉장히 많음. 공동현관 자동문의 경우 짐을 옮기기 위해 입주민이 직접 스위치를 눌러 자동문을 꺼버리면 이상 징후 경고 메시지를 띄우게 되는 상황이 발생함.

- 개선 방안
    - 각 시설물에 대한 경고 레벨을 정하여 경고 레벨에 맡게 경고 메시지 타입을 설정함.
        - 입주민의 안전과 관련된 시설은 하이레벨. 경고를 전체 화면에 띄워 즉각 파악하고 조취할 수 있도록 함.
        - 지금 당장 수리하지 않아도 되는 시설물에 대해 라벨링하여 경고를 일정 기간 띄우지 않도록 하는 기능.
        - 시설물을 유지 보수 관련하여 우선순위를 파악하여 그에 맞는 경고 레벨, 라벨, 경고 메시지 타입을 설정 하도록 함.
    - 각 시설물에 대한 변수 파악이 필요하고 그에 맞는 솔루션을 찾아 적용시켜야 함.

---

# 250818 피드백을 통한 개선점 찾기
## Red 단계 완료 보고서
### OpenEye_CCTV
### 날짜: 250818
### 발견한 핵심 문제
- 템플릿 매칭에 사용되는 초록색 네모 박스 영역에 사람이나 물건이 들어오면 의자가 움직이지 않아도 패턴 이탈 감지를 하는 문제가 있음.

[문제 상황 사진]

<img alt="image" src="https://github.com/guysaint/openeye_cctv/blob/main/src/tests/problem.png">

### 설정한 목표
- Before: 템플릿 매칭으로 의자의 위치와 모양(상태)를 인식해서 변경되는 부분을 패턴 이탈 상황으로 감지시킴. 
- After: 템플릿 매칭을 canny edge로 선 처리후 인식을 했을 때 기존 템플릿 매칭과 비교하여 얼마나 개선이 되는지 비교.

### 동료 피드백 요약
- 박영찬: 템플릿 매칭이 좋은 것 같다. yolo를 이용해서 사람이 인식되면 그 것을 제외 시키면 될 것 같다. 아니면 의자를 매칭하는 박스 크기를 의자에 딱 맞게 설정해보는 것도 좋을 것 같다.
- 홍찬호: 
---

# 250819 개선
- 지난 목표 후기: 비교 후 드라마틱한 개선점을 발견하지 못했음. 오히려 기존 템플릿 매칭만을 이용하여 기능을 구현하는 것이 원래 의도에 더 부합하다고 판단됨.
### 설정한 목표
- 발견된 문제를 한계점으로 설정하고 시설물 관리 측면에서 유동인구가 없는 시설물에 대해 이상을 감지하는 프로그램으로 개발 방향을 전환.
- 추후 프로그램을 발전시키는 방향으로 유동인구가 있는 시설물에도 적용해볼 예정

### 현재 상황
 - 캠으로 실시간으로 템플릿 매칭에 성공. usb를 활용해 마치 벨브와 같은 움직임으로 테스트 완료.

 [Demo 영상]<img alt="image" src="../assets/prototype.gif">


### 오늘의 목표
- 한 앵글에 여러가지 물건의 패턴이 가능하도록 시도해보기.

### 동료 피드백 요약
- 박영찬: 좁게 보면 지금 자체의 문제는 yolo를 쓰면 해결 될 것 같다. 다른 라이브러리를 활용하는 것이 좋을 것 같다.
시설물이 다양하고 그에 따른 조건이 다양하다. 실제 로직에 적용시키는 것이 어려울 것 같다.
문제 해결방법에 있어서 다양하게 접근 하는 것이 좋은 것 같다.

- 홍찬호: 이 기능이 사용되는 상황을 다르게 하면 하는 데 도움이 될 것 같다. 예를 들어 관리 시설에 접목하면 더 적합할 것 같다.

# 250820 중간 점검
# OpenEye_CCTV
- 시설물 관리 cctv에 opencv를 적용하여 시설물의 패턴에 이상이 감지되면 중앙관제실 모니터에 경고문을 띄워주는 시스템
## 발견한 문제
- 문제를 발견한 순간: 거주하고 있는 아파트 공동현관이 고장이나 며칠 째 문이 열려있었음. 문이 열려있다보니 둘째 아이가 뛰어 들어가다가 공동현관 자동문 프레임 모서리에 이마를 부딪혀 사고가 발생함.

- 이 문제에 집중한 이유: 이상이 있는 시설물이 제 때 파악이 되지 않아 고장이 방치되어 사고로 발생된 것이라고 생각함. 문이 열려있지 않았다면 아이가 뛰어 들어가지 않았을 것으로 예상되어 이상이 발생한 시설물이 제 때 감지되어 방치되는 상황을 줄일 수 있다면 입주민 안전을 더 확보할 수 있을 것이라고 예상되어 이 문제에 집중함.

- 문제가 발생한 상황: 사고 발생 후 CCTV를 통해 알게 된 것은 공동현관 자동문이 열린 후에 센서 문제로 15분 후에 닫히는 문제가 있었음. 경비원이 순찰을 돌지만 순찰 당시에 공동현관문이 닫혀있었으면 이상 징후를 발견하지 못할 가능성이 높아 방치되었다고 판단되었음. 

## 문제 해결 노력
- 처음 생각한 아이디어: 자동문의 경우 일정한 패턴이 있기 때문에 패턴을 벗어나게 되는 경우 미리 중앙관제실에 경고를 주게 되면 **명확한 고장 상태**가 아닌 **패턴에서 벗어나는 이상한 작동**을 파악할 수 있게 되면 내가 경험한 사고가 예방될 수 있겠다고 생각함.

- 실제로 만든 것: 벨브 모양과 유사한 usb 스틱을 opencv의 템플릿 매칭으로 실시간 감지하여 패턴 이상을 감지하는 것을 구현함.

- 이 방법을 선택한 이유: 시설관리 CCTV의 경우 앵글이 고정되어 있고 관리대상 시설물은 특정 패턴을 가지고 있기 때문에 그 룰을 벗어나는 상황만 감지하도록 하면 쉽게 구현이 될 것이라고 생각하여 템플릿 매칭을 선택함.
## 문제 해결 과정
- 가장 막현던 순간: 최초 **의자**로 패턴이상을 감지하는 것을 구현에 성공했는데 발견된 문제점은 의자와 매칭되는 관심영역에 다른 물체(사람이나 물건)이 들어오게 되면 패턴 이상으로 감지하는 문제가 있었음. 생각해보니 템플릿 매칭이라는 로직에서는 당연한 결과였음. 예를들어 아파트 공동현관의 경우 유동인구가 많고 입주민이 아닌 사람이 세대를 호출하는 과정에서 공동현관 앞에서 대기하는 상황 마다 패턴 이상이라고 감지하게 될 것으로 예상이 되는 문제에 막힘.

- 이 문제를 해결하기 위해서 기술적으로 좀 더 고민을 해야하는 상황. 시간 관계상 패턴 이상 감지의 대상을 사람이 이동하는 경로에 없는 시설물에 대해서 우선 구현을 시도해보는 것이 현실적인 구현 가능한 상황이라고 판단해서 우선적으로 고정적인 시설물의 패턴을 감지하는 수준으로 구현을 하기로 결정함.

- 도움 받은 도구: chatGPT로 코딩에 도움을 받음.

## 현재 결과
- 템플릿 매칭으로 실시간 감지 구현에 성공함. 한 앵글에 여러 시설물이 있을 경우에도 감지 테스트도 성공함.

- 동료들 반응: 시설관리 부분에 있어 굉장히 좋은 것 같다. 시설 관리 비용 절감, 순찰에만 의지해야 하는 시설관리, 장기간 고장이 방치되는 것을 방지 하는 등. 다만 구현하는 데에 많은 데이터셋이 필요해 보인다.

- 예상과 달랐던 점: 사람이 이동이 잦은 시설물의 경우 변수가 많다는 것.

## 앞으로..
- 더 하고 싶은 것: 최초 아이디어의 시작이 되었던 공동현관 패턴 이상 감지 시스템 구현
- 배운 점: 처음 예상한 것 보다 실제로 프로젝트에 들어갔을 때 맞닥들이는 변수와 문제점이 많다는 것을 알게됨.
- 다음에 비슷한 문제를 만나면 좀 더 변수와 문제를 예상하여 프로젝트에 접근해야겠음.

### 강사 피드백
- cctv에서 더 발전될 만한 것이 없다고 생각했는데 이 기술은 도입되면 좋을 것 같다.
- 시각적으로 타겟을 띄우는 것. 아파트 지도(cctv위치가 표기된)에서 현재 경고를 보내는 cctv가 어떤 곳인지 표시해주는 것이 추가되면 좋을 것 같다.

